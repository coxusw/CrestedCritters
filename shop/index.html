---
layout: default
title: Shop
---

<section class="section">
  <div class="container">
    <div class="section-head">
      <h2>Shop</h2>
      <p class="muted">Browse by category or view everything.</p>
    </div>

    {%- assign categories = site.products | map: "category" | uniq | sort -%}

    <!-- Anchor targets for /shop/#category-slug deep links -->
    <div class="shop-anchors">
      {%- for cat in categories -%}
        <div id="{{ cat | slugify }}"></div>
      {%- endfor -%}
    </div>

    <!-- Filter Tabs (auto-generated) -->
    <div class="filters" id="filters">
      <button class="filter-btn is-active" data-filter="all" data-slug="">All</button>

      {%- for cat in categories -%}
        <button class="filter-btn"
                data-filter="{{ cat }}"
                data-slug="{{ cat | slugify }}">
          {{ cat }}
        </button>
      {%- endfor -%}
    </div>

    <div class="product-grid" id="productGrid">
      {%- assign sorted = site.products | sort: "title" -%}
      {%- for product in sorted -%}

        {%- assign is_sold = false -%}
        {%- if product.sold_out == true or product.inventory == 0 -%}
          {%- assign is_sold = true -%}
        {%- endif -%}

        <div class="p-card"
             data-category="{{ product.category }}"
             data-category-slug="{{ product.category | slugify }}">

          <a href="{{ product.url | relative_url }}" class="p-link">
            <div class="p-img">
              {%- if product.image -%}
                {%- assign img = product.image -%}
                {%- if img contains '://' -%}
                  <img src="{{ img }}" alt="{{ product.title }}">
                {%- else -%}
                  <img src="{{ img | relative_url }}" alt="{{ product.title }}">
                {%- endif -%}
              {%- else -%}
                <div class="p-img-placeholder">No image</div>
              {%- endif -%}

              {%- if is_sold -%}
                <span class="badge sold">Sold Out</span>
              {%- else -%}
                {%- if product.inventory and product.inventory <= 4 -%}
                  <span class="badge low">Low stock: {{ product.inventory }}</span>
                {%- else -%}
                  <span class="badge stock">{{ product.inventory }} in stock</span>
                {%- endif -%}
              {%- endif -%}
            </div>

            <div class="p-body">
              <div class="p-top">
                <h3>{{ product.title }}</h3>
                <span class="price">${{ product.price }}</span>
              </div>
              <p class="muted p-cat">{{ product.category }}</p>
            </div>
          </a>

          <div class="p-actions">
            {%- if is_sold -%}
              <button class="btn ghost btn-full" disabled>Sold Out</button>
            {%- else -%}
              {%- if product.square_link and product.square_link != "" -%}
                <a class="btn primary btn-full"
                   href="{{ product.square_link }}"
                   target="_blank"
                   rel="noopener">
                  Buy Now
                </a>
              {%- else -%}
                <button class="btn ghost btn-full" disabled>Add Square Link</button>
              {%- endif -%}
            {%- endif -%}
          </div>

        </div>
      {%- endfor -%}
    </div>

    {%- if site.products.size == 0 -%}
      <p class="muted">No products yet. Add products in Admin → Products → New.</p>
    {%- endif -%}
  </div>
</section>

<script>
  (function () {
    const buttons = Array.from(document.querySelectorAll(".filter-btn"));
    const cards = Array.from(document.querySelectorAll(".p-card"));

    function setActive(btn) {
      buttons.forEach(b => b.classList.remove("is-active"));
      btn.classList.add("is-active");
    }

    function applyFilter(category) {
      cards.forEach(card => {
        const cardCat = card.getAttribute("data-category");
        const show = (category === "all") || (cardCat === category);
        card.style.display = show ? "" : "none";
      });
    }

    function findButtonBySlug(slug) {
      return buttons.find(b => (b.getAttribute("data-slug") || "") === slug) || null;
    }

    function applyHashFilter() {
      const slug = (window.location.hash || "").replace("#", "").toLowerCase();

      if (!slug) {
        const allBtn = buttons.find(b => b.getAttribute("data-filter") === "all");
        if (allBtn) setActive(allBtn);
        applyFilter("all");
        return;
      }

      const btn = findButtonBySlug(slug);
      if (btn) {
        setActive(btn);
        applyFilter(btn.getAttribute("data-filter"));
      } else {
        // Unknown slug => show all
        const allBtn = buttons.find(b => b.getAttribute("data-filter") === "all");
        if (allBtn) setActive(allBtn);
        applyFilter("all");
      }
    }

    buttons.forEach(btn => {
      btn.addEventListener("click", () => {
        const cat = btn.getAttribute("data-filter");
        const slug = btn.getAttribute("data-slug") || "";

        setActive(btn);
        applyFilter(cat);

        if (cat === "all") {
          history.replaceState(null, "", window.location.pathname);
        } else {
          window.location.hash = slug;
        }
      });
    });

    // Initial load (supports /shop/#category)
    applyHashFilter();
    window.addEventListener("hashchange", applyHashFilter);
  })();
</script>
